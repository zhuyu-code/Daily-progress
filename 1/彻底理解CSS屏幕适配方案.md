         * [问题分析](#问题分析)
         * [为什么需要适配？](#为什么需要适配)
         * [物理像素pt](#物理像素pt)
         * [逻辑像素px（也叫css像素）](#逻辑像素px也叫css像素)
         * [设计像素](#设计像素)
         * [相对像素（em和rem）](#相对像素em和rem)
         * [屏幕尺寸](#屏幕尺寸)
         * [Dpr](#dpr)
         * [PPI](#ppi)
         * [Rpx](#rpx)
         * [CSS设备px关系](#css设备px关系)
         * [关于选购手机的屏幕](#关于选购手机的屏幕)
         * [屏幕适配方案](#屏幕适配方案)
### 问题分析

1. 为什么按照设计图上面做出来的内容，测试的时候会出现问题？

2. 为什么在移动端不同机型的效果显示不同？
3. Pt,px,rpx,rem,em,wh,vh,尺寸5.5这些单位到底是什么意思？

### 为什么需要适配？

主要是市面上的移动设备，电脑等屏幕大小不统一，而我们开发的项目，它将来会在各种应用上使用，也会在各种各样的设备上运行，所以屏幕适配就是非常重要且必要的了。但是为了降低开发难度，我们一般之时适配绝大部分设备，而不是所以设备。

### 物理像素pt

现在的设备基本上用的都是液晶屏，这种屏幕的显示原理就是在一块屏幕区域上规则排布很多个发光二极管，系统通过控制这些发光点的颜色和亮度来达到显示的作用。在一块屏幕区域上，每一个发光点，就是我们说的一个物理像素。一些屏幕厂商标识的分辨率指的就是这个物理像素的多少，比如手机标的屏幕像素是 1080×2340，就表示这块屏幕上每行有 1080 个物理像素点，每列上有 2340 个物理像素点。

注意：

> 物理像素是出厂后固定的，我们的代码无法设置和改变，是属于设备本身的。

### 逻辑像素px（也叫css像素）

在出现物理像素后，出现一个问题，市面上各个屏幕大小不一致，几百到几千都有。也就是假如一个图片在300pt上显示得很好，在2000pt上就会出现很不均衡的样子，只有1/7这样区域显示，那就很麻烦。后面各大厂商提出了逻辑像素的概念。比如320 物理像素宽的设备上，我们让 1 逻辑像素 = 1 物理像素，那整个宽度还是能容下 320px 的内容；而对于 1200 宽度的设备，我们让它 1 逻辑像素 = 3 物理像素，这样相当于这块屏幕可以放下 400px 的内容。这时候再定义一个 320像素宽的按钮，在低分辨率上是占满整个宽度，而在高清屏上也能占五分之四左右的宽度，这种显示效果就已经很相近了。所以逻辑像素一致，物理像素不一致。

注意：

高分辨率屏幕上会把多个物理像素当成 1 个逻辑像素来用，但不会和低清屏幕上一样，把 1 个逻辑像素里的多个物理像素显示成同样的颜色。所以高分辨率屏幕虽然和低分辨率屏幕的逻辑像素差不多，但在显示细节和清晰度上还是有区别的，这就是为什么高清屏的显示效果会更细腻。

### 设计像素

屏幕逻辑像素最大也就是四百多一点，何必用那么大的设计稿呢？这是因为这些设备虽然逻辑像素差不多少，但同样 1px 的内容，有的设备用 1 个物理像素点显示，而有的用 9 个物理像素点来显示。如果设计稿使用的分辨率够大，那么高分辨率的屏幕里每 px 里的 9 个物理像素可以显示不同的颜色，而低分辨率屏幕里只能把图片里相近的颜色做合并，显示在一个物理像素上。所以用高清的设计稿，最终做出来的显示效果会更细腻。在公司里，设计像素一般用到 1080 的宽度也就差不多了。

### 相对像素（em和rem）

px是绝对像素，给定后是绝对的。但是不够灵活，所以催生了更加灵活的相对像素

1. **相对像素 em**。em 这个单位是相对于父元素的 font-size 字号值，实际就是父元素 font-size 的几倍。这个字号可以是 CSS 指定的，也可以是从父元素的父元素继承来的，如果前两个都没有，就会使用默认值（一般是16px）。假如父元素指定了 “font-size:20px;” ,子元素使用了 “width: 8em” ，那么子元素的实际宽度就是 160px。
   我们在使用 em 单位的时候，如果 HTML 层级太深，这个相对关系就容易乱，并且其中一个节点改动字号的话，里面的子元素的 em 值都要重新调整，会造成不便。
2. **相对像素 rem**。rem 和 em 很相似，只不过它是相对于根节点，也就是 HTML 节点的 font-size 属性指定的 px 值。页面里所有用 rem 作为长度单位的元素，就都以 HTML 为准，这样就不用使用 em 那种比较麻烦的换算了，并且当页面里的元素改变字号时，不会对其他元素造成影响。

### 屏幕尺寸

屏幕尺寸就是对角线长度，指的是英寸，然后1英寸等于0.762寸，1寸等于3.3厘米，那么1英寸等于2.54厘米。

下面就是常见设备的关系

| 设备名称          | 屏幕尺寸 | 物理像素(宽*高) | 逻辑像素(宽*高) |
| :---------------- | :------- | :-------------- | :-------------- |
| iPhone X          | 5.8      | 1125 x 2436     | 375 x 812       |
| iPhone 8          | 4.7      | 750x1334        | 375x667         |
| iPhone 8+         | 5.5      | 1242 x 2208     | 414 x 736       |
| Samsung Galaxy S8 | 5.8      | 1440 x 2960     | 360 x 740       |
| HUAWEI P10        | 5.1      | 1080 x 1920     | 360 x 640       |
| 红米 4 (4, 4X)    | 5.0      | 720 x 1280      | 360 x 640       |

### Dpr

DPR = 设备像素 / CSS像素(某一方向上)

在早先的移动设备中，并没有DPR的概念。随着技术的发展，移动设备的屏幕像素密度越来越高。从iphone4开始，苹果公司推出了所谓的retina视网膜屏幕。之所以叫做视网膜屏幕，是因为屏幕的PPI(屏幕像素密度)太高，人的视网膜无法分辨出屏幕上的像素点。iphone4的分辨率提高了一倍，但屏幕尺寸却没有变化，这意味着同样大小的屏幕上，像素多了一倍，于是DPR = 2

### PPI

ppi是指屏幕上每英寸可以显示的像素点的数量，即屏幕像素密度，逻辑像素的分别平方勾股定理除以对角线开根号。

### Rpx

在小程序中，px是固定单位，不会根据手机不同而进行弹性适配，所以出现了Rpx的概念，

### CSS设备px关系

CSS中的 1px 并不等于设备的1px
从iphone4开始，推出了所谓的Retina屏，分辨率提高了一倍，变成640*960，但屏幕尺寸却没变化，这就意味着同样大小的屏幕上，像素却多了一倍，这时，1个CSS像素是等于4个物理像素的。

1物理像素边框的实现
当viewport的属性initial-scale为1时，页面大小正常，但initial-scale为0.5时，页面被缩小了1倍，像素比为2:1的设备本来1个CSS像素宽度占2个物理像素宽度，缩小后的1个CSS像素宽度就只占1个物理像素，即实现了真正的1物理像素。

屏幕能够显示的最小粒度是1个物理像素，iPhone4的像素比为2，设置border-width:1px后，边框占了4个物理像素，如果能让边框的宽度为1物理像素，那么它就比1个CSS像素要细。

实现1：viewport

设置 `<meta name="viewport" content="width=device-width, initial-scale=0.5"> `实现。


实现2：transform 的 scale

如果 dpr 为2，可以使用 transform: scale(0.5)。

实现2：媒体查询

```
@media (-webkit-min-device-pixel-ratio:2),(min-device-pixel-ratio:2){
    .border-bt-1px {
        position: relative;
        &::after {
            position: absolute;
            bottom: 0;
            width: 100%;
            height: 1px;
            background-color: green;
            transform: scaleY(0.5);
        }
    }
}
```

### 关于选购手机的屏幕

720p就是逻辑像素720列，1080p就是逻辑像素1080列,2K屏就是逻辑像素为2000列，三星的旗舰一般都是2k屏,其他品牌旗舰一般1080p偏多，但是2k屏，刷新率高的屏幕续航容易尿崩，

### 屏幕适配方案

前面铺垫了这么多，终于要进入这节的正题，开始聊一下屏幕的适配方案。刚才讲过，虽然用逻辑像素代替物理像素抹平了一些屏幕差异，但屏幕的宽度依然不一致，所以还是要对屏幕做适配（我们一般所说的适配，大部分都是在关注页面的宽度）。

在做屏幕适配的时候，通常是选择一个大小适中的设备作为基准尺寸，然后再对其他尺寸的设备做适配。比较常见的适配方法有下面几种：

**一、百分比方式适配**

用百分比做适配的方式是比较原始的一种适配方式。我们通过给元素设置一个百分比的值，让这个元素自动调整它的大小或位置等。这种方式出现的最早，也是在使用的时候最方便的。Bootstrap 框架在很多地方就采用了这种方案。

百分比适配有如下优点：

1. 简单便捷，不用关心元素的绝对宽度。
2. 基本没有兼容性问题。

但是这种适配方式缺点也是很明显的：

1. 使用百分比时候，很容易不是整数，比如设计稿是一行里三个元素等分距离，如果用百分比，那每个的宽度就是 33.33333%。这样百分比是很长的小数，还要自己计算百分比的值，最严重的是经过百分比的计算后有可能最后整行宽度会留有空白。
2. 百分比的值是相对于父元素来计算的。子元素宽度的百分比是相对父元素宽度，子元素的高度的百分比是相对于父元素的高度，子元素的内外边距都是相对父元素的宽度，这些属性是相对谁的容易弄混。
3. 当同一行里同时存在定宽元素和自适应的元素时，使用百分比就不太利于分配空间。
4. 如果父子元素都脱离了文档流，那么它父元素的宽度就可能没有了，这时候子元素用百分比就会失效。

通过用百分比的方式适配的话，在一些情景下是非常方便的，比如一行内等距放 4 个元素，就可以每个元素 25% 的宽度，一条语句就可以搞定，但考虑到百分比适配的缺点，并不推荐所有地方都强制使用百分比进行适配。我们的项目中，用到百分比适配比较多的是需要撑开整个屏幕的情况，如头部标题栏、导航和全屏宽的按钮等设置宽度的时候，就可以直接给元素“width: 100%；”。

**二、多套样式分段适配**

我们要说的第二种适配方案就是制作多套样式，然后根据屏幕宽度来选择合适的那套样式。这种适配方式一般是在 HTML 或 body 上添加一些 class 来控制。

我们以京东的 PC 端页面为例，当浏览器宽度大于 1190px 时，就会在 HTML 标签上加上 o2_wide 的 class，这时候页面的主要内容区也是定宽 1190px 的一个框子。当浏览器小于 1190px时，就会把 o2_wide 变成 o2_mini，这时候主要显示区的宽度就变成了 990px。京东实际上是实现了两种宽度的页面，然后通过 JS 判断页面宽度来选择应用哪一套。

淘宝的 PC 端会做的更精细一点，会把适配方案分成 990px、1024px、1190px、1279px、1365px、1440px 这些档，对每一种宽度都做了一套样式。然后也是通过 JS 控制 body 上的 class 来控制生效的样式。

上面两个例子都是使用 JS 来控制 DOM 元素上的 class 来实现的，在 CSS3 中还有一种控制方式叫媒体查询。媒体查询可以直接用 CSS 根据浏览器页面宽度判断使用哪套样式方案。原理和上面的一样，只不过用媒体查询代替了上面的 JS 逻辑。

这种适配方案有如下的优点：

1. 更灵活，比如可以借助根节点上的 class 来控制更多的内容。比如在宽屏幕上指定一行显示 4 个元素（每个宽 25%），如果在窄屏幕上可以让一行显示 5 个（每个宽 20%）。
2. 页面宽度是固定的几档，测试的时候比较方便。
3. 使用 JS 控制 class 的方式一般不会出现兼容性问题，通常应用在有兼容性要求的 PC 端页面。

但这种方式的不足也比较明显：

1. 需要制作多套设计稿，也需要多套样式代码，工作量比较大。
2. 要维护多套样式，有改动的时候比较麻烦。
3. 不能在所有设备下都撑满全屏，不适合移动端。

这种适配方案在适配时一般都是设计一套基准宽度的样式，其他宽度下的样式用覆盖的方式来控制。

**三、Rem 方式适配**

最后就是要说 Rem 方式的适配了。我们之前讲了 Rem 的用法，在做屏幕适配的时候，我们通过控制 HTML 的　font-size 属性就可以了。

第一步，限定基准尺寸屏幕下的 HTML 字号。我通常会给 HTML 节点设置上 20px 的字体，这样做 px 到 rem 的转换时比较容易，比如我需要 18px 的宽度，那就可以很快的把 18px 换算成 .9rem。

第二步，在其他尺寸屏幕上，修改 HTML 字号值。在 rem 适配中，因为只需要控制 HTML 字号就可以达到屏幕适配的目的。而在变动这个字号的时候可以像百分比适配那样做连续的变动，直接按着屏幕宽度和标准尺寸的比例关系修改字号即可；也可以用分段适配的方式，在某一个宽度范围内用哪一种字号。对字号的控制还是比较灵活的。

Rem 适配的优点：

1. Rem 的参考值只有一个，就是 HTML 字体大小，所以不会像百分比适配那样要明确参考谁。
2. Rem 使用的范围比较广，元素的高度宽度、border 宽度、字号大小、间距和偏移量等都可以用 rem 做单位
3. Rem 适配的时候不需要做多套样式，可以直接按比例改变 HTML字体的大小。

Rem 适配的缺点：

1. Rem 是 CSS3 的属性，只有比较新的浏览器上可以使用，一般都是用在移动端。目前大厂的 H5 页面，基本都在使用 Rem 方式做屏幕适配了。
2. Rem 最后换算出来的值还是 px，所以对于按比例分配空间这种需求是没法满足的，需要和其他适配方式混合使用。

**四、弹性布局适配**
最后说一下弹性布局，这也是 CSS3 里出现的一种适配方式。弹性布局融合了百分比布局和固定宽度布局的优点，并且用起来更加简单。弹性布局下盒模型可以不用指定宽度，直接让盒子把可利用空间填满，这样既不用去计算盒子的宽度，也不用担心固定宽度元素和需要适配的元素在同一行显示的问题了。

弹性布局的优点有：

1. 可以弹性地利用页面空间，且不需要计算宽度比例。
2. 每行元素个数变化时，不用重新调整元素的宽度。
3. 弹性布局中的高级属性能带来更多的功能，比如可以指定元素的排列方式和排列顺序等，这些功能用传统的 CSS 是不太好实现的。

而弹性布局最重要的缺点就是兼容性问题，在移动端有些弹性布局的属性都还没有得到完全的支持，在使用时一定要做详细的测试。这个项目中的标题栏、底部导航、网格等组件中，都使用了弹性布局，到时会带着同学们更详细地了解这种布局方式。